[pytest]
# Enable asyncio support
asyncio_mode = auto

# Add the tests directory to the Python path
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Show detailed diffs in assertion errors
diff = 1

# Show local variables in tracebacks
showlocals = True

# Enable color output
addopts = -v --color=yes

# Enable test coverage
addopts += --cov=app --cov-report=term-missing --cov-report=html:htmlcov

# Fail if test coverage is below 80%
addopts += --cov-fail-under=80

# Ignore deprecation warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning

# Configure logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Test timeouts (in seconds)
timeout = 30
timeout_method = signal

# Parallel test execution
addopts += -n auto

# Show test durations for slowest 10 tests
addopts += --durations=10

# Enable xdist for parallel test execution
addopts += --dist=loadscope

# Enable test retries for flaky tests
addopts += --reruns 1 --reruns-delay 1

# Enable test ordering
deprecated-option = xdist_workers = current: xdist_workers is now a built-in fixture

# Enable test markers
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: mark integration tests
    unit: mark unit tests
    e2e: mark end-to-end tests
    performance: mark performance tests
    db: mark tests that require database access
    auth: mark authentication tests
    users: mark user management tests
    documents: mark document tests
    ai: mark AI/ML tests
    retrieval: mark retrieval tests
    embeddings: mark embedding tests
